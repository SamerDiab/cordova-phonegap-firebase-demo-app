/*
 * Copyright 2019 Samer Diab emil: contact@samerdiab.net
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#!/usr/local/bin/node-bench

var Promise = require("events").Promise;

var xml = require("posix").cat("test.xml").wait(),
  path = require("path"),
  sax = require("../lib/sax"),
  saxT = require("../lib/sax-trampoline"),
  
  parser = sax.parser(false, {trim:true}),
  parserT = saxT.parser(false, {trim:true}),
  
  sys = require("sys");


var count = exports.stepsPerLap = 500,
  l = xml.length,
  runs = 0;
exports.countPerLap = 1000;
exports.compare = {
  "switch" : function () {
    // sys.debug("switch runs: "+runs++);
    // for (var x = 0; x < l; x += 1000) {
    //   parser.write(xml.substr(x, 1000))
    // }
    // for (var i = 0; i < count; i ++) {
      parser.write(xml);
      parser.close();
    // }
    // done();
  },
  trampoline : function () {
    // sys.debug("trampoline runs: "+runs++);
    // for (var x = 0; x < l; x += 1000) {
    //   parserT.write(xml.substr(x, 1000))
    // }
    // for (var i = 0; i < count; i ++) {
      parserT.write(xml);
      parserT.close();
    // }
    // done();
  },
};

sys.debug("rock and roll...");